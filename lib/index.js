"use strict";const e=["onChange","onBlur","onKeyPress","value"],t=["onChange"],n=["selectTime","onFocusedDateChange","selectedDate","focusedDate","timeStep","onSelect","customValidation"],s=["value","onChange","customValidation"],i=["value","inputValue","customValidation","onInputChange","onChange","selectTime","timeStep"],l=["value","markers","title","description","placeholder","parseInputValue","formatInputValue","deserialize","serialize","selectTime","timeStep","readOnly","level","onChange","customValidation"],a=["type","onChange"],o=["selected","schedules","state"],r=["focusedDate","onFocusedDateChange","onSelect","selectedDate"];var d,c,u,h,x,p;function m(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n,s,i={},l=Object.keys(e);for(s=0;s<l.length;s++)n=l[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)n=l[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}Object.defineProperty(exports,"__esModule",{value:!0});var v=require("@sanity/icons"),y=require("sanity"),C=require("sanity/router"),k=require("react/jsx-runtime"),w=require("@sanity/ui"),S=require("react"),M=require("styled-components"),T=require("@vvo/tzdb"),D=require("date-fns-tz"),L=require("debug"),I=require("date-fns"),B=require("react-focus-lock"),A=require("lodash/range"),z=require("lodash"),E=require("swr"),V=require("pluralize"),F=require("rxjs"),O=require("rxjs/operators"),P=require("@sanity/util/paths"),R=require("@sanity/color"),W=require("react-virtual");function N(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function U(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var H=N(S),Z=N(M),q=N(L),_=N(B),X=N(A),Y=N(E),G=N(V),Q=U(P);const J=e=>{const{buttonText:t="Action",disabled:n,icon:s,onAction:i,onComplete:l,tone:a="positive"}=e;return k.jsxs(w.Flex,{children:[k.jsx(w.Card,{flex:1,children:k.jsx(w.Button,{mode:"bleed",onClick:l,style:{width:"100%"},text:"Cancel"})}),i&&k.jsx(w.Card,{flex:1,marginLeft:3,children:k.jsx(w.Button,{disabled:n,icon:s,onClick:i,style:{width:"100%"},text:t,tone:a})})]})},K=e=>{const{body:t,title:n}=e;return k.jsxs(w.Stack,{paddingY:1,space:3,children:[k.jsxs(w.Inline,{space:2,children:[k.jsx(v.CalendarIcon,{}),n&&k.jsx(w.Text,{size:2,weight:"semibold",children:n})]}),t&&k.jsx(w.Text,{size:1,children:t})]})},$={publish:{actionName:"Publishing",badgeColor:"primary",badgeTone:"positive"},unpublish:{actionName:"Unpublishing",badgeColor:"danger",badgeTone:"critical"}},ee={scheduled:{title:"Upcoming"},succeeded:{title:"Completed"},cancelled:{title:"Failed"}},te=Object.keys(ee).filter((e=>!!e)),ne="This document has validation errors that should be resolved before its publish date.",se=k.jsxs(k.Fragment,{children:["Scheduled Publishing is only available on"," ",k.jsx("a",{href:"https://sanity.io/pricing",children:"Growth or higher plans"}),". Please upgrade to enable access."]}),ie={SMALL:"d MMM yy',' p",MEDIUM:"d MMMM yyyy',' p",LARGE:"iiii',' d MMMM yyyy',' p"},le="scheduled-publishing:";function ae(e){const t="".concat(le).concat(e);return q.default&&q.default.enabled(t)?q.default(t):q.default(le)}function oe(e){let t;var n;return"object"==typeof(n=e)&&n&&"statusCode"in n&&"response"in n?t=403===e.response.statusCode?"Forbidden. Please check that your project has access to Scheduled Publishing.":e.message:(e instanceof Error&&(t=e.message),t=String(e)),t}q.default(le);const re=ae("useScheduleOperation"),de=T.getTimeZones().map((e=>({abbreviation:e.abbreviation,alternativeName:e.alternativeName,mainCities:e.mainCities.join(", "),name:e.name,namePretty:e.name.replaceAll("_"," "),offset:e.currentTimeFormat.split(" ")[0],value:"".concat(e.currentTimeFormat," ").concat(e.abbreviation," ").concat(e.name)})));function ce(){return de.find((e=>e.name===Intl.DateTimeFormat().resolvedOptions().timeZone))||de.find((e=>"GMT"===e.abbreviation))||de[0]}function ue(){const e=localStorage.getItem("scheduled-publishing::time-zone");try{if(e)return JSON.parse(e)}catch(e){}return ce()}const he=()=>{const e=S.useMemo((()=>ue()),[]),[t,n]=S.useState(e),s=w.useToast();S.useEffect((()=>{const e=()=>{n(ue())};return window.addEventListener("timeZoneEventUpdate",e),()=>{window.removeEventListener("timeZoneEventUpdate",e)}}),[]);const i=S.useCallback((e=>{let{date:n,format:s=ie.LARGE,includeTimeZone:i,prefix:l}=e,a=s;return l&&(a="'".concat(l,"'").concat(s)),i&&(a="".concat(s," (zzzz)")),D.formatInTimeZone(n,t.name,a)}),[t.name]),l=S.useCallback((()=>D.utcToZonedTime(new Date,t.name)),[t.name]),a=S.useCallback((e=>{re("handleNewValue:",e),n((t=>{try{t.name!==e.name&&(localStorage.setItem("scheduled-publishing::time-zone",JSON.stringify(e)),window.dispatchEvent(new Event("timeZoneEventUpdate"))),s.push({closable:!0,description:k.jsx(K,{body:"".concat(e.alternativeName," (").concat(e.namePretty,")"),title:"Time zone updated"}),duration:15e3,status:"info"})}catch(e){console.error(e),s.push({closable:!0,description:k.jsx(K,{body:oe(e),title:"Unable to update time zone"}),status:"error"})}return e}))}),[s]),o=S.useCallback((e=>D.utcToZonedTime(e,t.name)),[t.name]),r=S.useCallback((e=>D.zonedTimeToUtc(e,t.name)),[t.name]);return{formatDateTz:i,getCurrentZoneDate:l,setTimeZone:a,timeZone:t,utcToCurrentZoneDate:o,zoneDateToUtc:r}},xe=Z.default.span((e=>{let{theme:t}=e;return M.css(d||(d=b(["\n    color: ",";\n    font-weight: 500;\n    margin-left: 1em;\n  "])),t.sanity.color.base.fg)})),pe=Z.default.span((e=>{let{theme:t}=e;return M.css(c||(c=b(["\n    color: ",";\n    margin-left: 1em;\n  "])),t.sanity.color.input.default.readOnly.fg)})),me=e=>{const{onClose:t}=e,{setTimeZone:n,timeZone:s}=he(),[i,l]=S.useState(s),a=(null==i?void 0:i.name)!==s.name,o=S.useMemo((()=>(null==i?void 0:i.name)===ce().name),[i]);return k.jsx(w.Dialog,{footer:k.jsx(w.Box,{paddingX:4,paddingY:3,children:k.jsx(J,{buttonText:"Update time zone",disabled:!a||!i,onAction:()=>{i&&n(i),null==t||t()},onComplete:t,tone:"primary"})}),header:"Select time zone",id:"time-zone",onClose:t,width:1,children:k.jsxs(w.Stack,{padding:4,space:5,children:[k.jsx(w.Text,{size:1,children:"The selected time zone will change how dates are represented in schedules."}),k.jsxs(w.Stack,{space:3,children:[k.jsxs(w.Flex,{align:"center",justify:"space-between",children:[k.jsxs(w.Inline,{space:2,children:[k.jsx(w.Text,{size:1,weight:"semibold",children:"Time zone"}),o&&k.jsx(w.Text,{muted:!0,size:1,children:"local time"})]}),!o&&k.jsx(w.Text,{size:1,weight:"medium",children:k.jsx("a",{onClick:()=>{l(ce())},style:{cursor:"pointer"},children:"Select local time zone"})})]}),k.jsx(w.Autocomplete,{fontSize:2,icon:v.SearchIcon,id:"timezone",onChange:e=>{const t=de.find((t=>t.value===e));l(t)},openButton:!0,options:de,padding:4,placeholder:"Search for a city or time zone",popover:{boundaryElement:document.querySelector("body"),constrainSize:!0,placement:"bottom-start"},renderOption:e=>k.jsx(w.Card,{as:"button",padding:3,children:k.jsxs(w.Text,{size:1,textOverflow:"ellipsis",children:[k.jsxs("span",{children:["GMT",e.offset]}),k.jsx(xe,{children:e.alternativeName}),k.jsx(pe,{children:e.mainCities})]})}),renderValue:(e,t)=>t?"".concat(t.alternativeName," (").concat(t.namePretty,")"):"",tabIndex:-1,value:null==i?void 0:i.value})]})]})})};function fe(){const[e,t]=S.useState(!1),n=S.useCallback((()=>{t(!1)}),[]);return{visible:e,show:S.useCallback((()=>{t(!0)}),[]),hide:n}}function je(){const{visible:e,show:t,hide:n}=fe();return{DialogTimeZone:e?me:null,dialogProps:{onClose:n,visible:e},dialogTimeZoneShow:t,hide:n}}const ge=e=>{const{useElementQueries:t}=e,{timeZone:n}=he(),{DialogTimeZone:s,dialogProps:i,dialogTimeZoneShow:l}=je();return k.jsxs(k.Fragment,{children:[s&&k.jsx(s,j({},i)),k.jsx(w.Tooltip,{content:k.jsx(w.Box,{padding:2,children:k.jsxs(w.Text,{muted:!0,size:1,children:["Displaying schedules in ",n.alternativeName," (GMT",n.offset,")"]})}),portal:!0,children:t?k.jsxs(k.Fragment,{children:[k.jsx(w.Box,{className:"button-small",children:k.jsx(w.Button,{fontSize:1,icon:v.EarthAmericasIcon,mode:"bleed",onClick:l,text:"".concat(n.abbreviation)})}),k.jsx(w.Box,{className:"button-large",children:k.jsx(w.Button,{fontSize:1,icon:v.EarthAmericasIcon,mode:"bleed",onClick:l,text:"".concat(n.alternativeName," (").concat(n.namePretty,")")})})]}):k.jsx(w.Button,{fontSize:1,icon:v.EarthAmericasIcon,mode:"bleed",onClick:l,text:"".concat(n.alternativeName," (").concat(n.namePretty,")")})})]})},be=Z.default(w.ElementQuery)(u||(u=b(["\n  .button-small {\n    display: block;\n  }\n  .button-large {\n    display: none;\n  }\n\n  &[data-eq-min~='2'] {\n    .button-small {\n      display: none;\n    }\n    .button-large {\n      display: block;\n    }\n  }\n"]))),ve=e=>{const{title:t}=e;return k.jsx(be,{children:k.jsxs(w.Flex,{align:"center",children:[t,k.jsx("input",{style:{opacity:0},tabIndex:-1,type:"button"}),k.jsx(w.Box,{style:{position:"absolute",right:"-1.5em"},children:k.jsx(ge,{useElementQueries:!0})})]})})};function ye(e){const{date:t,focused:n,isCurrentMonth:s,isToday:i,customValidation:l,onSelect:a,selected:o}=e,r=S.useMemo((()=>!l||l(I.endOfDay(t))),[t,l]),d=S.useCallback((()=>{r&&a(t)}),[t,r,a]);return k.jsx("div",{"aria-selected":o,"data-ui":"CalendarDay",children:k.jsx(w.Card,{"aria-label":t.toDateString(),"aria-pressed":o,as:"button",__unstable_focusRing:!0,"data-weekday":!0,"data-focused":n?"true":"",disabled:!r,role:"button",tabIndex:-1,onClick:d,padding:3,radius:2,selected:o,tone:i||o?"primary":"default",children:k.jsx(w.Text,{muted:!o&&!s,style:{textAlign:"center"},weight:s?"medium":"regular",children:t.getDate()})})})}const Ce=["January","February","March","April","May","June","July","August","September","October","November","December"],ke=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],we=z.range(0,24),Se=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Me=[1,2,3,4,5,6],Te=e=>{return(t=(e=>{const t=I.startOfMonth(e);return I.eachWeekOfInterval({start:t,end:I.lastDayOfMonth(t)})})(e),t.map((e=>[e,...Me.map((t=>I.addDays(e,t)))]))).map((e=>({number:I.getWeek(e[0]),days:e})));var t};function De(e){const{getCurrentZoneDate:t}=he(),{customValidation:n}=e;return k.jsx(w.Box,{"aria-hidden":e.hidden||!1,"data-ui":"CalendarMonth",children:k.jsxs(w.Grid,{gap:1,style:{gridTemplateColumns:"repeat(7, minmax(44px, 46px))"},children:[ke.map((e=>k.jsx(w.Box,{paddingY:2,children:k.jsx(w.Text,{size:1,weight:"medium",style:{textAlign:"center"},children:e})},e))),Te(e.date).map(((s,i)=>s.days.map(((s,l)=>{const a=e.focused&&I.isSameDay(s,e.focused),o=e.selected&&I.isSameDay(s,e.selected),r=I.isSameDay(s,t()),d=e.focused&&I.isSameMonth(s,e.focused);return k.jsx(ye,{date:s,focused:a,isCurrentMonth:d,isToday:r,customValidation:n,onSelect:e.onSelect,selected:o},"".concat(i,"-").concat(l))}))))]})})}const Le=!1,Ie=H.default.forwardRef((function(t,n){let{onChange:s,onBlur:i,onKeyPress:l,value:a}=t,o=m(t,e);const[r,d]=H.default.useState(),c=H.default.useCallback((e=>{d(e.currentTarget.value)}),[]),u=H.default.useCallback((e=>{e.currentTarget.value!=="".concat(a)&&s&&s(e),d(void 0)}),[s,a]),h=H.default.useCallback((e=>{u(e),i&&i(e)}),[u,i]),x=H.default.useCallback((e=>{"Enter"===e.key&&u(e),l&&l(e)}),[u,l]);return k.jsx(w.TextInput,j(j({},o),{},{"data-testid":"date-input",ref:n,value:void 0===r?a:r,onChange:c,onBlur:h,onKeyPress:x}))})),Be=e=>{let{onChange:n}=e,s=m(e,t);const i=H.default.useCallback((e=>{const t=parseInt(e.currentTarget.value,10);isNaN(t)||n(t)}),[n]);return k.jsx(Ie,j(j({},s),{},{onChange:i,inputMode:"numeric"}))},Ae=k.jsx("span",{"data-preserve-focus":!0,style:{overflow:"hidden",position:"absolute",outline:"none"},tabIndex:-1}),ze=S.forwardRef((function(e,t){const{getCurrentZoneDate:s,zoneDateToUtc:i}=he(),{selectTime:l,onFocusedDateChange:a,selectedDate:o=s(),focusedDate:r=o,timeStep:d=1,onSelect:c,customValidation:u}=e,h=m(e,n),x=S.useCallback((e=>a(i(e))),[a,i]),p=S.useCallback((e=>x(I.setDate(I.setMonth(r,e),1))),[r,x]),f=S.useCallback((e=>p(Number(e.currentTarget.value))),[p]),g=S.useCallback((e=>x(I.addMonths(r,e))),[r,x]),b=S.useCallback((e=>x(I.setYear(r,e))),[r,x]),v=S.useCallback((e=>{c(i(I.setMinutes(I.setHours(e,o.getHours()),o.getMinutes())))}),[c,o,i]),y=S.useCallback((e=>{const t=Number(e.currentTarget.value);c(i(I.setMinutes(o,t)))}),[c,o,i]),C=S.useCallback((e=>{const t=Number(e.currentTarget.value);c(i(I.setHours(o,t)))}),[c,o,i]);S.useCallback(((e,t)=>{c(i(I.setHours(I.setMinutes(o,t),e)))}),[c,o,i]);const M=w.useForwardedRef(t),T=S.useCallback((()=>{var e,t;null==(t=null==(e=M.current)?void 0:e.querySelector('[data-focused="true"]'))||t.focus()}),[M]),D=S.useCallback((e=>{var t,n;Se.includes(e.key)&&(e.preventDefault(),e.currentTarget.hasAttribute("data-calendar-grid")?T():("ArrowUp"===e.key&&a(i(I.addDays(r,-7))),"ArrowDown"===e.key&&a(i(I.addDays(r,7))),"ArrowLeft"===e.key&&a(i(I.addDays(r,-1))),"ArrowRight"===e.key&&a(i(I.addDays(r,1))),null==(n=null==(t=M.current)?void 0:t.querySelector("[data-preserve-focus]"))||n.focus()))}),[i,M,T,a,r]);S.useEffect((()=>{T()}),[T]),S.useEffect((()=>{var e;(null==(e=document.activeElement)?void 0:e.matches("[data-calendar-grid], [data-calendar-grid] [data-preserve-focus]"))&&T()}),[M,T,r]);const L=S.useCallback((()=>c(new Date)),[c]);return k.jsxs(w.Box,j(j({"data-ui":"Calendar"},h),{},{ref:M,children:[k.jsxs(w.Box,{padding:2,children:[k.jsxs(w.Flex,{children:[k.jsx(w.Box,{flex:1,children:k.jsx(Ee,{moveFocusedDate:g,onChange:f,value:null==r?void 0:r.getMonth()})}),k.jsx(w.Box,{marginLeft:2,children:k.jsx(Ve,{moveFocusedDate:g,onChange:b,value:r.getFullYear()})})]}),k.jsxs(w.Box,{"data-calendar-grid":!0,onKeyDown:D,marginTop:2,overflow:"hidden",tabIndex:0,children:[k.jsx(De,{date:r,focused:r,customValidation:u,onSelect:v,selected:o}),Ae]})]}),l&&k.jsxs(w.Box,{padding:2,style:{borderTop:"1px solid var(--card-border-color)"},children:[k.jsxs(w.Flex,{align:"center",children:[k.jsxs(w.Flex,{align:"center",flex:1,children:[k.jsx(w.Box,{children:k.jsx(w.Select,{"aria-label":"Select hour",value:null==o?void 0:o.getHours(),onChange:C,children:we.map((e=>k.jsx("option",{value:e,children:"".concat(e).padStart(2,"0")},e)))})}),k.jsx(w.Box,{paddingX:1,children:k.jsx(w.Text,{children:":"})}),k.jsx(w.Box,{children:k.jsx(w.Select,{"aria-label":"Select minutes",value:null==o?void 0:o.getMinutes(),onChange:y,children:X.default(0,60,d).map((e=>k.jsx("option",{value:e,children:"".concat(e).padStart(2,"0")},e)))})})]}),k.jsx(w.Box,{marginLeft:2,children:k.jsx(w.Button,{text:"Set to current time",mode:"bleed",onClick:L})})]}),Le]})]}))}));function Ee(e){const{moveFocusedDate:t,onChange:n,value:s}=e,i=S.useCallback((()=>t(-1)),[t]),l=S.useCallback((()=>t(1)),[t]);return k.jsxs(w.Flex,{flex:1,children:[k.jsx(w.Button,{"aria-label":"Go to previous month",onClick:i,mode:"bleed",icon:v.ChevronLeftIcon,paddingX:2,radius:0}),k.jsx(w.Box,{flex:1,children:k.jsx(w.Select,{radius:0,value:s,onChange:n,children:Ce.map(((e,t)=>k.jsx("option",{value:t,children:e},t)))})}),k.jsx(w.Button,{"aria-label":"Go to next month",mode:"bleed",icon:v.ChevronRightIcon,onClick:l,paddingX:2,radius:0})]})}function Ve(e){const{moveFocusedDate:t,onChange:n,value:s}=e,i=S.useCallback((()=>t(-12)),[t]),l=S.useCallback((()=>t(12)),[t]);return k.jsxs(w.Flex,{children:[k.jsx(w.Button,{"aria-label":"Previous year",onClick:i,mode:"bleed",icon:v.ChevronLeftIcon,paddingX:2,radius:0}),k.jsx(Be,{value:s,onChange:n,radius:0,style:{width:65}}),k.jsx(w.Button,{"aria-label":"Next year",onClick:l,mode:"bleed",icon:v.ChevronRightIcon,paddingX:2,radius:0})]})}const Fe=H.default.forwardRef((function(e,t){const{utcToCurrentZoneDate:n}=he(),{value:i=new Date,onChange:l,customValidation:a}=e,o=m(e,s),[r,d]=H.default.useState(),c=H.default.useCallback((e=>{l(e),d(void 0)}),[l]);return k.jsx(ze,j(j({},o),{},{ref:t,selectedDate:n(i),onSelect:c,focusedDate:n(r||i),onFocusedDateChange:d,customValidation:a}))})),Oe=H.default.forwardRef((function(e,t){const{value:n,inputValue:s,customValidation:l,onInputChange:a,onChange:o,selectTime:r,timeStep:d}=e,c=m(e,i),[u,h]=H.default.useState(null),x=w.useForwardedRef(t),p=H.default.useRef(null),[f,g]=H.default.useState(!1),b=w.usePortal();w.useClickOutside((()=>g(!1)),[u]);const y=S.useCallback((()=>{var e,t;null==(e=x.current)||e.focus(),null==(t=x.current)||t.select()}),[x]),C=S.useCallback((e=>{"Escape"===e.key&&g(!1)}),[]),M=S.useCallback((()=>g(!0)),[]),T=k.jsx(w.Box,{padding:1,children:k.jsx(w.Button,{ref:p,icon:v.CalendarIcon,mode:"bleed",padding:2,onClick:M,style:{display:"block"},"data-testid":"select-date-button"})});return k.jsx(Ie,j(j({ref:x},c),{},{value:s,onChange:a,suffix:f?k.jsx(w.LayerProvider,{zOffset:1e3,children:k.jsx(w.Popover,{constrainSize:!0,content:k.jsx(w.Box,{overflow:"auto",children:k.jsx(_.default,{onDeactivation:y,children:k.jsx(Fe,{selectTime:r,timeStep:d,onKeyUp:C,value:n,onChange:o,customValidation:l})})}),"data-testid":"date-input-dialog",fallbackPlacements:["bottom","bottom-start","top-end","top","top-start"],floatingBoundary:b.element,open:!0,placement:"bottom-end",portal:!0,radius:2,ref:h,children:T})}):T}))})),Pe=H.default.forwardRef((function(e,t){const{value:n,markers:s,title:i,description:a,placeholder:o,parseInputValue:r,formatInputValue:d,deserialize:c,serialize:u,selectTime:h,timeStep:x,readOnly:p,level:f,onChange:g,customValidation:b}=e,v=m(e,l),[C,M]=H.default.useState(null);S.useEffect((()=>{M(null)}),[n]);const{zoneDateToUtc:T}=he(),D=void 0===n,L=H.default.useCallback((e=>{const t=e.currentTarget.value,n=""===t?null:r(t);null===n?(g(null),D&&C&&M(null)):n.isValid?g(u(T(n.date))):M(t)}),[D,T,C,u,g,r]),I=H.default.useCallback((e=>{g(e?u(e):null)}),[u,g]),B=w.useForwardedRef(t),A=S.useId(),z=C?r(C):n?c(n):null,E=C||((null==z?void 0:z.isValid)?d(z.date):n),V=S.useMemo((()=>s.map((e=>({level:e.level,path:e.path,message:e.item.message})))),[s]);return k.jsx(y.FormField,{validation:(null==z?void 0:z.error)?[...V,{level:"error",message:z.error,path:[]}]:V,title:i,level:f,description:a,inputId:A,children:p?k.jsx(w.TextInput,{value:E,readOnly:!0}):k.jsx(Oe,j(j({},v),{},{id:A,selectTime:h,timeStep:x,placeholder:o||"e.g. ".concat(d(new Date)),ref:B,value:null==z?void 0:z.date,inputValue:E||"",readOnly:Boolean(p),onInputChange:L,onChange:I,customValidity:null==z?void 0:z.error,customValidation:b}))})}));function Re(e){return e.toISOString()}function We(e){const t=new Date(e);return(n=t)instanceof Date&&!isNaN(n.valueOf())?{isValid:!0,date:t}:{isValid:!1,error:'Invalid date value: "'.concat(e,'"')};var n}const Ne=H.default.forwardRef((function(e,t){const{type:n,onChange:s}=e,i=m(e,a),{title:l,description:o,placeholder:r}=n,{getCurrentZoneDate:d,timeZone:c}=he(),{customValidation:u,customValidationMessage:h,dateFormat:x,timeFormat:p,timeStep:f}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{customValidation:e.customValidation||function(){return!0},customValidationMessage:e.customValidationMessage||"Invalid date.",calendarTodayLabel:e.calendarTodayLabel||"Today",dateFormat:e.dateFormat||"yyyy-MM-dd",timeFormat:e.timeFormat||"HH:mm",timeStep:"timeStep"in e&&Number(e.timeStep)||1}}(n.options),g=S.useCallback((e=>{let t=e;null!==t&&f>1&&(t=function(e,t){if(!t||1===t)return e;const n=I.parseISO(e),s=I.getMinutes(n),i=s%t;return Re(0!==i?I.setMinutes(n,s-i):n)}(t,f)),s(t)}),[s,f]),b=H.default.useCallback((e=>D.formatInTimeZone(e,c.name,"".concat(x," ").concat(p))),[x,p,c.name]),v=H.default.useCallback((e=>{const t=I.parse(e,"".concat(x," ").concat(p),d());return I.isValid(t)?u(t)?{isValid:!0,date:t}:{isValid:!1,error:h}:{isValid:!1,error:'Invalid date. Must be on the format "'.concat(x," ").concat(p,'"')}}),[h,u,x,d,p]);return k.jsx(Pe,j(j({},i),{},{onChange:g,ref:t,selectTime:!0,timeStep:f,title:l,description:o,placeholder:r,serialize:Re,deserialize:We,formatInputValue:b,customValidation:u,parseInputValue:v}))})),Ue=e=>{const{onChange:t,value:n}=e,{getCurrentZoneDate:s}=he(),[i,l]=S.useState();return k.jsx(w.Stack,{space:4,children:k.jsx(w.Card,{children:k.jsx(Ne,{level:0,markers:[],onChange:e=>{e&&t&&(t({date:e}),l(e))},type:{name:"date",options:{customValidation:e=>e>s(),customValidationMessage:"Date cannot be in the past.",dateFormat:"dd/MM/yyyy",timeFormat:"HH:mm"},title:"Date and time"},value:void 0===i?null==n?void 0:n.date:i})})})};function He(e){const{onChange:t,value:n}=e;return k.jsxs(w.Stack,{space:4,children:[e.children,k.jsx(Ue,{onChange:t,value:n})]})}const Ze=e=>{const{description:t,title:n}=e;return k.jsx(w.Card,{overflow:"hidden",padding:4,radius:2,shadow:1,tone:"critical",children:k.jsxs(w.Flex,{align:"center",gap:4,children:[k.jsx(w.Text,{size:2,children:k.jsx(v.ErrorOutlineIcon,{})}),k.jsxs(w.Inline,{space:2,children:[k.jsx(w.Text,{size:1,weight:"semibold",children:n}),t&&k.jsx(w.Text,{size:1,children:t})]})]})})},qe=S.createContext(void 0);function _e(e){let{children:t,value:n}=e;return k.jsx(qe.Provider,{value:n,children:t})}const Xe={refreshWhenHidden:!1,refreshWhenOffline:!1,revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1,shouldRetryOnError:!1};function Ye(){const e=y.useClient({apiVersion:"2022-09-01"}),t="/projects/".concat(e.config().projectId,"/features/scheduledPublishing"),n=S.useCallback((()=>e.request({method:"GET",uri:t})),[e,t]),{data:s}=Y.default(t,n,Xe);return s}function Ge(e){return(null==e?void 0:e.executedAt)||(null==e?void 0:e.executeAt)}function Qe(){let{reverseOrder:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reverseOrder:!1};return function(t,n){const s=Ge(t),i=Ge(n);return s===i?0:null===s?1:null===i?-1:(s>i?1:-1)*(e?-1:1)}}const Je=ae("useScheduleOperation");function Ke(){const e=y.useClient({apiVersion:"2022-09-01"});return S.useMemo((()=>function(e){const{dataset:t,projectId:n}=e.config();function s(s){let{action:i,date:l,documentId:a}=s;Je("_create:",a,i);const o=new Date(l);return o.setSeconds(0),o.setMilliseconds(0),e.request({body:{action:i,documents:[{documentId:a}],executeAt:o,name:o},method:"POST",uri:"/schedules/".concat(n,"/").concat(t)})}function i(s){let{scheduleId:i}=s;return Je("_delete:",i),e.request({method:"DELETE",uri:"/schedules/".concat(n,"/").concat(t,"/").concat(i)})}function l(e){let{scheduleIds:t}=e;Je("_deleteMultiple:",t);const n=t.map((e=>i({scheduleId:e})));return Promise.allSettled(n)}function a(s){let{scheduleId:i}=s;return Je("_publish:",i),e.request({method:"POST",uri:"/schedules/".concat(n,"/").concat(t,"/").concat(i,"/publish")})}function o(s){let{documentSchedule:i,scheduleId:l}=s;return Je("_update:",l,i),e.request({body:i,method:"PATCH",uri:"/schedules/".concat(n,"/").concat(t,"/").concat(l)})}return{create:s,delete:i,deleteMultiple:l,publish:a,update:o}}(e)),[e])}var $e=(e=>(e.create="scheduleCreate",e.delete="scheduleDelete",e.deleteMultiple="scheduleDeleteMultiple",e.publish="schedulePublish",e.update="scheduleUpdate",e))($e||{});const et=(e,t)=>new CustomEvent(e,t);function tt(){const e=w.useToast(),{formatDateTz:t}=he(),n=Ke();return{createSchedule:async function(s){let{action:i,date:l,displayToast:a=!0,documentId:o}=s;try{const s=await n.create({action:i,date:l,documentId:o});window.dispatchEvent(et("scheduleCreate",{detail:{action:i,date:l,documentId:o}})),a&&(null==s?void 0:s.executeAt)&&e.push({closable:!0,description:k.jsx(K,{body:t({date:new Date(s.executeAt),includeTimeZone:!0,prefix:"publish"===i?"Publishing on ":"Unpublishing on "}),title:"".concat(i.charAt(0).toUpperCase()+i.slice(1)," scheduled")}),duration:15e3,status:"success"})}catch(t){a&&e.push({closable:!0,description:k.jsx(K,{body:oe(t),title:"Unable to ".concat(i," schedule")}),duration:15e3,status:"error"})}},deleteSchedule:async function(t){let{displayToast:s=!0,schedule:i}=t;try{await n.delete({scheduleId:null==i?void 0:i.id}),window.dispatchEvent(et("scheduleDelete",{detail:{scheduleId:null==i?void 0:i.id}})),s&&e.push({closable:!0,description:k.jsx(K,{title:"Schedule deleted"}),status:"success"})}catch(t){s&&e.push({closable:!0,description:k.jsx(K,{body:oe(t),title:"Unable to delete schedule"}),duration:15e3,status:"error"})}},deleteSchedules:async function(t){let{displayToast:s=!0,schedules:i}=t;try{const t=i.map((e=>e.id)),l=await n.deleteMultiple({scheduleIds:t}),{fulfilledIds:a,rejectedReasons:o}=l.reduce(((e,t,n)=>("fulfilled"===t.status&&e.fulfilledIds.push(i[n].id),"rejected"===t.status&&e.rejectedReasons.push("[".concat(i[n].id,"]: ").concat(t.reason)),e)),{fulfilledIds:[],rejectedReasons:[]}),r=a.length,d=o.length;(null==a?void 0:a.length)>0&&window.dispatchEvent(et("scheduleDeleteMultiple",{detail:{scheduleIds:a}})),s&&((null==a?void 0:a.length)>0&&e.push({closable:!0,description:k.jsx(K,{title:"".concat(G.default("schedule",r,!0)," deleted")}),status:"success"}),(null==o?void 0:o.length)>0&&e.push({closable:!0,description:k.jsx(K,{body:null==o?void 0:o.toString(),title:"Unable to delete ".concat(G.default("schedule",d,!0))}),duration:15e3,status:"error"}))}catch(t){s&&e.push({closable:!0,description:k.jsx(K,{body:oe(t),title:"Unable to delete schedules"}),duration:15e3,status:"error"})}},publishSchedule:async function(t){let{displayToast:s=!0,schedule:i}=t;try{const t=i.id;await n.publish({scheduleId:t}),window.dispatchEvent(et("schedulePublish",{detail:{scheduleId:t}})),s&&e.push({closable:!0,description:k.jsx(K,{title:"Document published"}),status:"success"})}catch(t){s&&e.push({closable:!0,description:k.jsx(K,{body:oe(t),title:"Unable to publish schedule"}),duration:15e3,status:"error"})}},updateSchedule:async function(s){let{date:i,displayToast:l=!0,scheduleId:a}=s;try{await n.update({documentSchedule:{executeAt:i},scheduleId:a}),window.dispatchEvent(et("scheduleUpdate",{detail:{date:i,scheduleId:a}})),l&&e.push({closable:!0,description:k.jsx(K,{body:t({date:new Date(i),includeTimeZone:!0,prefix:"Publishing on "}),title:"Schedule updated"}),duration:15e3,status:"success"})}catch(t){l&&e.push({closable:!0,description:k.jsx(K,{body:oe(t),title:"Unable to update schedule"}),duration:15e3,status:"error"})}}}}function nt(){const e=y.useClient({apiVersion:"2022-09-01"}),{dataset:t,projectId:n}=e.config();return"/schedules/".concat(n,"/").concat(t)}function st(e){const t=y.useClient({apiVersion:"2022-09-01"});return S.useCallback((()=>t.request({query:e.params,method:"GET",uri:e.url})),[t,e])}const it={refreshInterval:1e4,refreshWhenHidden:!1,refreshWhenOffline:!1,revalidateOnFocus:!1,revalidateOnReconnect:!0,shouldRetryOnError:!1},lt=[];function at(){let{documentId:e,state:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=nt(),s=S.useMemo((()=>({params:{documentIds:e,state:t},url:n})),[n,e,t]),i=st(s),{data:l,error:a,mutate:o}=Y.default(s,i,it),r=S.useCallback((e=>{o((t=>{var n;return{schedules:null==(n=null==t?void 0:t.schedules)?void 0:n.filter((t=>t.id!==e.detail.scheduleId))}}),!0)}),[o]),d=S.useCallback((e=>{o((t=>{var n;return{schedules:null==(n=null==t?void 0:t.schedules)?void 0:n.filter((t=>!e.detail.scheduleIds.includes(t.id)))}}),!0)}),[o]),c=S.useCallback((e=>{o((t=>{const n=(null==t?void 0:t.schedules)||[],s=n.findIndex((t=>t.id===e.detail.scheduleId));return{schedules:[...null==n?void 0:n.slice(0,s),j(j({},n[s]),{},{executeAt:(new Date).toISOString(),state:"succeeded"}),...null==n?void 0:n.slice(s+1)]}}),!0)}),[o]),u=S.useCallback((e=>{o((t=>{const n=(null==t?void 0:t.schedules)||[],s=n.findIndex((t=>t.id===e.detail.scheduleId));return{schedules:[...null==n?void 0:n.slice(0,s),j(j({},n[s]),{},{executeAt:e.detail.date}),...null==n?void 0:n.slice(s+1)]}}),!0)}),[o]);S.useEffect((()=>(window.addEventListener($e.delete,r),window.addEventListener($e.deleteMultiple,d),window.addEventListener($e.publish,c),window.addEventListener($e.update,u),()=>{window.removeEventListener($e.delete,r),window.removeEventListener($e.deleteMultiple,d),window.removeEventListener($e.publish,c),window.removeEventListener($e.update,u)})),[r,d,c,u]);const h=S.useMemo((()=>{var e;return null==(e=null==l?void 0:l.schedules)?void 0:e.sort(Qe())}),[null==l?void 0:l.schedules]);return{error:a,isInitialLoading:!a&&!l,schedules:h||lt}}function ot(e){const[t,n]=S.useState(!1),[s,i]=S.useState(e&&(null==e?void 0:e.executeAt)?{date:e.executeAt}:null);return{formData:s,isDirty:t,onFormChange:S.useCallback((t=>{const s=(null==e?void 0:e.executeAt)&&new Date(e.executeAt).getTime()===new Date(null==t?void 0:t.date).getTime();i(t),n(!s)}),[null==e?void 0:e.executeAt])}}function rt(e){return S.useMemo((()=>e?e.replaceAll("drafts.",""):void 0),[e])}function dt(e){var t;return null==(t=e.documents)?void 0:t[0]}function ct(e){var t;return null==(t=dt(e))?void 0:t.documentId.replaceAll("drafts.","")}function ut(e){const t=dt(e),n=y.useSchema(),s=t.documentType;return S.useMemo((()=>{if(s)return n.get(s)}),[s,n])}const ht={validation:[],isValidating:!1};function xt(e){return S.useMemo((()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ht.validation;const t=e.filter(y.isValidationErrorMarker).length>0,n=e.filter(y.isValidationWarningMarker).length>0;let s="default";return n&&(s="default"),t&&(s="critical"),{markers:e,validationTone:s,hasError:t,hasWarning:n}}(e)),[e])}const pt=Z.default(w.Text)(h||(h=b(["\n  white-space: initial;\n"]))),mt={error:"critical",warning:"caution",info:"primary"};function ft(e){const{marker:t,onClick:n,path:s,truncate:i}=e,l=S.useCallback((()=>{n&&n(t.path)}),[t.path,n]),a=mt[null==t?void 0:t.level]||void 0,o=k.jsxs(w.Flex,{children:[k.jsx(w.Box,{children:k.jsxs(w.Text,{size:1,children:["error"===t.level&&k.jsx(v.ErrorOutlineIcon,{}),"warning"===t.level&&k.jsx(v.WarningOutlineIcon,{}),"info"===t.level&&k.jsx(v.InfoOutlineIcon,{})]})}),k.jsxs(w.Stack,{space:2,flex:1,paddingLeft:3,children:[s&&k.jsx(pt,{size:1,weight:"semibold",children:s}),t.item.message&&k.jsx(pt,{muted:!0,size:1,textOverflow:i?"ellipsis":void 0,children:t.item.message})]})]});return k.jsx(w.MenuItem,{padding:1,onClick:l,radius:2,tone:a,children:k.jsx(w.Box,{padding:2,children:o})})}function jt(e){const{documentType:t,kind:n,validation:s,onFocus:i,onClose:l,truncate:a}=e,o=s.filter(y.isValidationErrorMarker),r=s.filter(y.isValidationWarningMarker),d=s.filter(y.isValidationInfoMarker),c=S.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];i&&i(e),l&&l()}),[i,l]),u=e=>{const n=t&&t.fields,s=n&&n.find((t=>t.name===e[0]));return s&&s.type.title||""},h=o.length>0,x=r.length>0,p=d.length>0;return h||x||p?k.jsxs(w.Container,{width:0,"data-kind":n,"data-testid":"validation-list",children:[h&&o.map(((e,t)=>k.jsx(ft,{truncate:a,path:u(e.path),marker:e,onClick:c},t))),x&&r.map(((e,t)=>k.jsx(ft,{truncate:a,path:u(e.path),marker:e,onClick:c},t))),p&&d.map(((e,t)=>k.jsx(ft,{truncate:a,path:u(e.path),marker:e,onClick:c},t)))]}):null}const gt={portal:!0,constrainSize:!0,preventOverflow:!0,tone:"default",width:0};function bt(e){const{type:t,markers:n,menuHeader:s,documentId:i}=e,l=C.useRouter(),{hasError:a,hasWarning:o}=xt(n),r=a||o?"visible":"hidden",d=S.useId()||"",c=rt(i),u=S.useCallback((e=>{c&&l.navigateIntent("edit",{id:c,path:encodeURIComponent(Q.toString(e))})}),[l,c]);return k.jsx(w.MenuButton,{id:d||"",button:k.jsx(w.Button,{title:"Show validation issues",mode:"bleed","data-testid":"schedule-validation-list-button",icon:a?v.ErrorOutlineIcon:v.WarningOutlineIcon,style:{visibility:r},tone:a?"critical":"default"}),menu:k.jsx(w.Menu,{padding:1,children:k.jsx(w.Container,{width:0,children:k.jsxs(w.Stack,{space:1,children:[null!=s?s:null,k.jsx(jt,{documentType:t,validation:n,onFocus:u})]})})}),popover:gt,placement:"bottom-end"})}function vt(e){let{id:t,schemaType:n,onActionTypeChange:s,actionType:i}=e;return S.useEffect((()=>{const e=document.createElement("style");e.textContent="\n      input#actionTypeToggle {\n        --switch-bg-color: #6a7ea1;\n      }\n    ",document.head.appendChild(e)}),[]),k.jsxs(w.Stack,{space:4,children:[k.jsx(w.Text,{size:1,weight:"semibold",children:"Toggle Publish/Unpublish"}),k.jsxs(w.Flex,{align:"center",gap:2,children:[k.jsx(w.Text,{size:1,muted:"unpublish"===i,children:"Publish"}),k.jsx(w.Switch,{id:"actionTypeToggle",checked:"unpublish"===i,onChange:s}),k.jsx(w.Text,{size:1,muted:"publish"===i,children:"Unpublish"})]}),k.jsxs(w.Text,{size:1,children:["Schedule this document to be ","publish"===i?"published":"unpublished"," at any time in the future.",k.jsx("br",{}),"Any edits in the meantime will be added to the scheduled document."]}),k.jsx(w.Text,{size:1,children:"Visit the Schedules page to get an overview of all schedules."}),k.jsx(yt,{id:t,type:n})]})}function yt(e){let{id:t,type:n}=e;const s=rt(t),i=function(e){const t=y.useSchema();return S.useMemo((()=>t.get(e)),[e,t])}(n),l=y.useValidationStatus(s,n),{hasError:a}=xt(l.validation);return a?k.jsx(w.Card,{padding:2,radius:1,shadow:1,tone:"critical",children:k.jsxs(w.Flex,{gap:1,align:"center",children:[k.jsx(bt,{markers:l.validation,type:i,documentId:s}),k.jsx(w.Text,{size:1,children:ne})]})}):null}function Ct(e,t){const n=y.useDocumentPreviewStore(),[s,i]=S.useState({});return S.useEffect((()=>{if(!t)return;const s=function(e,t,n,s){const i=(e=>!0===e.liveEdit)(t)?F.of({snapshot:null}):e.observeForPreview({_type:"reference",_ref:y.getDraftId(n)},t),l=e.observeForPreview({_type:"reference",_ref:y.getPublishedId(n)},t);return F.combineLatest([i,l]).pipe(O.map((e=>{let[t,n]=e;return{draft:t.snapshot?j({title:s},t.snapshot||{}):null,isLoading:!1,published:n.snapshot?j({title:s},n.snapshot||{}):null}})),O.startWith({draft:null,isLoading:!0,published:null}))}(n,t,e,"").subscribe((e=>{i(e)}));return()=>{null==s||s.unsubscribe()}}),[n,t,e]),s}const kt=Z.default(w.ElementQuery)(x||(x=b(["\n  .date-small {\n    display: inline;\n  }\n  .date-medium {\n    display: none;\n  }\n  .date-large {\n    display: none;\n  }\n\n  &[data-eq-min~='1'] {\n    .date-small {\n      display: none;\n    }\n    .date-medium {\n      display: inline;\n    }\n    .date-large {\n      display: none;\n    }\n  }\n\n  &[data-eq-min~='2'] {\n    .date-small {\n      display: none;\n    }\n    .date-medium {\n      display: none;\n    }\n    .date-large {\n      display: inline;\n    }\n  }\n"]))),wt=e=>{const{onClose:t,schedule:n}=e,{updateSchedule:s}=tt(),{formData:i,isDirty:l,onFormChange:a}=ot(n),o=S.useCallback((()=>{(null==i?void 0:i.date)&&s({date:i.date,scheduleId:n.id}).then(t)}),[n.id,s,t,null==i?void 0:i.date]);return k.jsx(w.Dialog,{footer:k.jsx(w.Box,{paddingX:4,paddingY:3,children:k.jsx(J,{buttonText:"Update",disabled:!l,onAction:o,onComplete:t,tone:"primary"})}),header:k.jsx(ve,{title:"Edit schedule"}),id:"time-zone",onClose:t,width:1,children:k.jsx(w.Box,{padding:4,children:k.jsx(He,{onChange:a,value:i})})})};function St(e){const{visible:t,show:n,hide:s}=fe();return{DialogScheduleEdit:t?wt:null,dialogProps:{onClose:s,schedule:e,visible:t},dialogScheduleEditShow:n,hide:s}}const Mt=e=>{const{currentUser:t,hasPermission:n,icon:s,onClick:i,permissionsOperationLabel:l,title:a,tone:o}=e;return k.jsx(w.Tooltip,{content:k.jsx(w.Box,{paddingX:2,paddingY:1,children:k.jsx(y.InsufficientPermissionsMessage,{currentUser:t,operationLabel:l})}),disabled:n,placement:"left",portal:!0,children:k.jsx("div",{children:k.jsx(w.MenuItem,{disabled:!n,icon:s,onClick:i,text:a,tone:o})})})},Tt=e=>{const{actions:t,onDelete:n,onEdit:s,schedule:i,schemaType:l}=e,a=dt(i),o=y.useCurrentUser(),[r,d]=y.useDocumentPairPermissions({id:a.documentId,type:null==l?void 0:l.name,permission:"publish"}),{deleteSchedule:c,publishSchedule:u}=tt(),h=!d&&!(null==r?void 0:r.granted),x=()=>{c({schedule:i}).then((()=>null==n?void 0:n()))};return o?k.jsxs(k.Fragment,{children:[(null==t?void 0:t.edit)&&k.jsx(Mt,{currentUser:o,hasPermission:!h,icon:v.CalendarIcon,onClick:()=>{null==s||s()},permissionsOperationLabel:"edit schedules",title:"Edit schedule"}),(null==t?void 0:t.execute)&&k.jsx(Mt,{currentUser:o,hasPermission:!h,icon:v.PublishIcon,onClick:()=>{u({schedule:i})},permissionsOperationLabel:"execute schedules",title:"Publish now"}),(null==t?void 0:t.delete)&&k.jsx(Mt,{currentUser:o,hasPermission:!h,icon:v.TrashIcon,onClick:x,permissionsOperationLabel:"delete schedules",title:"Delete schedule",tone:"critical"}),(null==t?void 0:t.clear)&&k.jsx(Mt,{currentUser:o,hasPermission:!h,icon:v.CheckmarkCircleIcon,onClick:x,permissionsOperationLabel:"delete schedules",title:"Clear completed schedule"})]}):null},Dt=e=>{const{actions:t,onDelete:n,onEdit:s,schedule:i,schemaType:l}=e;return k.jsx(w.MenuButton,{button:k.jsx(w.Button,{icon:v.EllipsisVerticalIcon,mode:"bleed",paddingX:2,paddingY:3,tone:"default"}),id:"contextMenu",menu:k.jsx(w.Menu,{children:k.jsx(Tt,{actions:t,onDelete:n,onEdit:s,schedule:i,schemaType:l})}),placement:"left",popover:{portal:!0,tone:"default"}})};function Lt(e){let{schedule:t,updateValidation:n}=e;const s=ut(t),i=ct(t);return i&&(null==s?void 0:s.name)?k.jsx(It,{id:i,schemaName:s.name,updateValidation:n}):null}function It(e){let{id:t,schemaName:n,updateValidation:s}=e;const[i,l]=S.useState(!1);return S.useEffect((()=>{const e=setTimeout((()=>{l(!0)}),1500);return()=>{clearTimeout(e)}}),[]),i?k.jsx(Bt,{id:t,schemaName:n,updateValidation:s}):null}function Bt(e){let{id:t,schemaName:n,updateValidation:s}=e;const i=y.useValidationStatus(t,n);return S.useEffect((()=>{i.isValidating||s(i)}),[s,i]),null}const At=e=>{const{date:t,useElementQueries:n}=e,{formatDateTz:s}=he(),i=I.formatDistance(t,new Date,{addSuffix:!0}),l=s({date:t,format:ie.LARGE}),a=s({date:t,format:ie.MEDIUM}),o=s({date:t,format:ie.SMALL});return k.jsx(w.Text,{size:1,textOverflow:"ellipsis",children:k.jsx(w.Tooltip,{content:k.jsx(w.Box,{padding:2,children:k.jsx(w.Text,{muted:!0,size:1,children:i})}),portal:!0,children:k.jsx("span",{children:n?k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"date-small",children:o}),k.jsx("span",{className:"date-medium",children:a}),k.jsx("span",{className:"date-large",children:l})]}):l})})})};function zt(e){let{time:t}=e;const n=y.useTimeAgo(t);return k.jsxs("span",{title:n,children:[n," ago"]})}const Et=e=>{let{document:t}=e;return k.jsx(w.Tooltip,{content:k.jsx(w.Box,{padding:2,children:k.jsx(w.Text,{size:1,children:t?k.jsxs(k.Fragment,{children:["Edited ",(null==t?void 0:t._updatedAt)&&k.jsx(zt,{time:null==t?void 0:t._updatedAt})]}):k.jsx(k.Fragment,{children:"No unpublished edits"})})}),portal:!0,children:k.jsx(y.TextWithTone,{tone:"caution",dimmed:!t,muted:!t,size:1,children:k.jsx(v.EditIcon,{})})})},Vt=e=>{let{document:t}=e;return k.jsx(w.Tooltip,{content:k.jsx(w.Box,{padding:2,children:k.jsx(w.Text,{size:1,children:t?k.jsxs(k.Fragment,{children:["Published ",t._updatedAt&&k.jsx(zt,{time:t._updatedAt})]}):k.jsx(k.Fragment,{children:"Not published"})})}),portal:!0,children:k.jsx(y.TextWithTone,{tone:"positive",dimmed:!t,muted:!t,size:1,children:k.jsx(v.PublishIcon,{})})})},Ft={portal:!0,constrainSize:!0,preventOverflow:!0,tone:"default",width:0},Ot=e=>{const{stateReason:t}=e;return k.jsx(w.MenuButton,{id:"stateReason",button:k.jsx(w.Button,{title:"Schedule failed",mode:"bleed","data-testid":"schedule-validation-list-button",icon:v.ErrorOutlineIcon,tone:"critical"}),menu:k.jsx(w.Menu,{padding:1,children:k.jsxs(w.Container,{padding:2,width:0,children:[k.jsx(w.Text,{size:1,children:"This schedule failed to run."}),k.jsxs(w.Flex,{gap:3,marginTop:4,padding:1,children:[k.jsx(w.Text,{size:1,style:{color:R.red[700].hex},children:k.jsx(v.ErrorOutlineIcon,{})}),k.jsx(w.Text,{size:1,style:{color:R.red[700].hex},weight:"medium",children:t})]})]})}),placement:"bottom-end",popover:Ft})},Pt=e=>{const{id:t}=e;return k.jsx(y.UserAvatar,{user:t,withTooltip:!0})},Rt=e=>{const{children:t,contextMenu:n,linkComponent:s,onClick:i,previewState:l,publishedDocumentId:a,schedule:o,schemaType:r,useElementQueries:d}=e,[c,u]=S.useState(ht),{validation:h}=c,{hasError:x,validationTone:p}=xt(h),{formatDateTz:m}=he(),f=Ge(o),j=f?new Date(f):null;return k.jsx(w.Card,{padding:1,radius:2,shadow:1,tone:p,children:k.jsxs(w.Flex,{align:"center",gap:1,justify:"space-between",children:[k.jsx(w.Card,{__unstable_focusRing:!0,as:s||void 0,"data-as":i||s?"a":void 0,flex:1,onClick:i,padding:1,radius:2,tabIndex:0,tone:p,children:k.jsxs(w.Flex,{align:"center",gap:3,justify:"flex-start",paddingLeft:t?0:[1,2],children:[t&&k.jsx(w.Box,{style:{flexBasis:"auto",flexGrow:1},children:t}),"unpublish"===o.action&&k.jsx(w.Flex,{style:{flexShrink:0},children:k.jsx(w.Badge,{fontSize:0,mode:"outline",tone:$[o.action].badgeTone,children:o.action})}),k.jsx(w.Box,{display:["block","none"],style:{flexShrink:0,width:"90px"},children:k.jsx(w.Stack,{space:2,children:j?k.jsxs(k.Fragment,{children:[k.jsx(w.Text,{size:1,children:m({date:j,format:"dd/MM/yyyy"})}),k.jsx(w.Text,{size:1,children:m({date:j,format:"p"})})]}):k.jsx(w.Text,{muted:!0,size:1,children:k.jsx("em",{children:"No date specified"})})})}),k.jsx(w.Box,{display:["none","block"],style:{flexShrink:0,maxWidth:"250px",width:t?"35%":"auto"},children:j?k.jsx(At,{date:j,useElementQueries:d}):k.jsx(w.Text,{muted:!0,size:1,children:k.jsx("em",{children:"No date specified"})})}),!t&&k.jsx(w.Box,{style:{visibility:"hidden"},children:k.jsx(y.SanityDefaultPreview,{isPlaceholder:!0})}),k.jsxs(w.Flex,{align:"center",style:{flexShrink:0,marginLeft:"auto"},children:[k.jsx(w.Box,{display:["none","none","block"],marginX:3,style:{flexShrink:0},children:k.jsx(Pt,{id:null==o?void 0:o.author})}),k.jsx(w.Box,{display:["none","block"],marginX:[2,2,3],style:{flexShrink:0},children:k.jsxs(w.Inline,{space:4,children:[k.jsx(Vt,{document:null==l?void 0:l.published}),k.jsx(Et,{document:null==l?void 0:l.draft})]})})]})]})}),k.jsxs(w.Flex,{justify:"center",style:{width:"38px"},children:["scheduled"===o.state&&k.jsxs(w.Box,{children:[k.jsx(Lt,{schedule:o,updateValidation:u}),k.jsx(bt,{markers:h,type:r,documentId:a,menuHeader:k.jsx(w.Box,{padding:2,children:k.jsx(w.Text,{size:1,children:x?ne:"This document has validation warnings."})})})]}),"cancelled"===o.state&&k.jsx(Ot,{stateReason:o.stateReason})]}),"cancelled"===o.state&&k.jsx(Ot,{stateReason:o.stateReason}),n&&k.jsx(w.Box,{style:{flexShrink:0},children:n})]})})},Wt=e=>{const{schedule:t,schemaType:n}=e,{DialogScheduleEdit:s,dialogProps:i,dialogScheduleEditShow:l}=St(t),{onComplete:a}=function(){const e=S.useContext(qe);if(void 0===e)throw new Error("useDocumentActionProps must be used within a DocumentActionPropsProvider");return e}(),o=S.useMemo((()=>ct(t)),[t]);return k.jsxs(k.Fragment,{children:[s&&k.jsx(s,j({},i)),k.jsx(Rt,{contextMenu:k.jsx(Dt,{actions:{delete:!0,edit:!0},onDelete:a,onEdit:l,schedule:t,schemaType:n}),onClick:l,publishedDocumentId:o,schedule:t,schemaType:n})]})},Nt=e=>{const{onDelete:t,schedule:n}=e,{deleteSchedule:s}=tt();return k.jsx(w.MenuButton,{button:k.jsx(w.Button,{icon:v.EllipsisVerticalIcon,mode:"bleed",paddingX:2,paddingY:3,tone:"default"}),id:"contextMenu",menu:k.jsx(w.Menu,{children:k.jsx(w.MenuItem,{icon:v.TrashIcon,onClick:()=>{s({schedule:n}).then((()=>null==t?void 0:t()))},text:"Delete schedule",tone:"critical"})}),placement:"left",popover:{portal:!0,tone:"default"}})},Ut=e=>{let{schedule:t}=e;return k.jsx(Rt,{contextMenu:k.jsx(Nt,{schedule:t}),schedule:t,useElementQueries:!0,children:k.jsx(y.SanityDefaultPreview,{icon:v.UnknownIcon,layout:"default",subtitle:k.jsx("em",{children:"It may have been deleted"}),title:k.jsx("em",{style:{color:R.red[600].hex},children:"Document not found"})})})},Ht=e=>{const{previewState:t,schedule:n,schemaType:s}=e,i=t.draft||t.published,l="succeeded"===n.state,a="scheduled"===n.state,{DialogScheduleEdit:o,dialogProps:r,dialogScheduleEditShow:d}=St(n),c=rt(null==i?void 0:i._id),u=S.useMemo((()=>S.forwardRef(((e,t)=>k.jsx(C.IntentLink,j(j({},e),{},{intent:"edit",params:{type:s.name,id:i&&y.getPublishedId(null==i?void 0:i._id)},ref:t}))))),[s,i]);return k.jsxs(k.Fragment,{children:[o&&k.jsx(o,j({},r)),k.jsx(Rt,{contextMenu:k.jsx(Dt,{actions:{clear:l,delete:!l,edit:a,execute:a},onEdit:d,schedule:n,schemaType:s}),linkComponent:u,previewState:t,publishedDocumentId:c,schedule:n,schemaType:s,useElementQueries:!0,children:t.isLoading?k.jsx(y.SanityDefaultPreview,{icon:null==s?void 0:s.icon,isPlaceholder:t.isLoading,layout:"default"}):k.jsx(y.Preview,{layout:"default",schemaType:s,value:i})})]})},Zt=e=>{const{schedule:t,type:n}=e,s=dt(t),i=ut(t),l=Ct(null==s?void 0:s.documentId,i),a=!(l.draft||l.published)&&!l.isLoading,o=S.useMemo((()=>!i||a?k.jsx(Ut,{schedule:t}):"document"===n?k.jsx(Wt,{schedule:t,schemaType:i}):"tool"===n?k.jsx(Ht,{previewState:l,schedule:t,schemaType:i}):null),[a,n,l,t,i]);return k.jsx(kt,{children:o})},qt=e=>{const{schedules:t}=e;return k.jsx(w.Stack,{space:4,children:0===t.length?k.jsx(w.Box,{children:k.jsx(w.Text,{size:1,children:"No schedules"})}):k.jsx(w.Stack,{space:2,children:t.map((e=>k.jsx(Zt,{schedule:e,type:"document"},e.id)))})})},_t=ae("ScheduleAction"),Xt=e=>{const{draft:t,id:n,liveEdit:s,onComplete:i,published:l,type:a}=e,o=y.useCurrentUser(),[r,d]=y.useDocumentPairPermissions({id:n,type:a,permission:"publish"}),{createSchedule:c}=tt(),u=Ye(),[h,x]=S.useState(!1),{formData:p,onFormChange:m}=ot(),{error:f,isInitialLoading:j,schedules:g}=at({documentId:n,state:"scheduled"});_t("schedules",g);const b=g&&g.length>0,C=null!==t||null!==l,M=!d&&!(null==r?void 0:r.granted),T=S.useCallback((()=>{x(!0)}),[]),[D,L]=S.useState("publish"),I=S.useCallback((()=>{(null==p?void 0:p.date)&&c({action:D,date:p.date,documentId:n}).then(i)}),[i,c,n,null==p?void 0:p.date,D]),B=e=>{L(e.target.checked?"unpublish":"publish")},A=b?"Edit Schedule":"Schedule";if(M)return{disabled:!0,icon:v.CalendarIcon,label:A,title:k.jsx(y.InsufficientPermissionsMessage,{currentUser:o,operationLabel:"edit schedules"})};let z,E="This document doesn't exist yet";return C&&(E=null),j&&(E="Loading schedules"),s&&(E="Live Edit is enabled for this content type and publishing happens automatically as you make changes"),z=!1===u?{content:k.jsx(w.Text,{size:1,children:se}),header:"Feature not available",onClose:i,type:"dialog"}:{content:f?k.jsx(Ze,{description:"More information in the developer console.",title:"Something went wrong, unable to retrieve schedules."}):k.jsx(_e,{value:e,children:b?k.jsx(qt,{schedules:g}):k.jsx(He,{onChange:m,value:p,children:k.jsx(vt,{id:n,schemaType:a,onActionTypeChange:B,actionType:D})})}),footer:!b&&k.jsx(J,{buttonText:"Schedule",disabled:!(null==p?void 0:p.date),icon:v.ClockIcon,onAction:I,onComplete:i,tone:"primary"}),header:k.jsx(ve,{title:A}),onClose:i,type:"dialog"},{dialog:h&&z,disabled:j||!C||s,label:A,icon:v.CalendarIcon,onHandle:T,title:E&&k.jsx(w.Box,{style:{maxWidth:"315px"},children:E})}};function Yt(e){const t=e.findIndex((e=>"publish"===e.action));return t<0?[Xt,...e]:[...e.slice(0,t+1),Xt,...e.slice(t+1)]}const Gt=ae("ScheduledBadge"),Qt=e=>{const{schedules:t}=at({documentId:e.id,state:"scheduled"});Gt("schedules",t);const n=null==t?void 0:t[0];if(!n||!n.executeAt)return null;const s=I.format(new Date(n.executeAt),ie.LARGE);return{color:$[n.action].badgeColor,label:"Scheduled",title:"".concat($[n.action].actionName," on ").concat(s," (local time)")}};function Jt(e){return[...e,Qt]}const Kt=S.createContext(void 0),$t=[];function en(e){let{children:t,value:n}=e;const[s,i]=S.useState(n.sortBy||"executeAt"),{utcToCurrentZoneDate:l}=he(),a=S.useCallback((e=>function(t){const n=Ge(t);if(!n)return!1;const s=new Date(n),i=l(s);return I.isSameDay(i,e)}),[l]),o=S.useCallback((e=>function(t){return t.state===e}),[]),r=S.useMemo((()=>n.schedules.filter((e=>n.selectedDate?a(n.selectedDate)(e):o(n.scheduleState)(e))).sort(((e,t)=>{if("createdAt"===s)return e[s]<t[s]?1:-1;if("executeAt"===s){return Qe({reverseOrder:!("scheduled"===n.scheduleState||n.selectedDate)})(e,t)}return 1}))||[]),[o,n.schedules,n.scheduleState,n.selectedDate,s,a]),d=S.useCallback((e=>n.schedules.filter(a(e)).sort(Qe())),[n.schedules,a]);return k.jsx(Kt.Provider,{value:{activeSchedules:r,schedules:n.schedules||$t,schedulesByDate:d,scheduleState:n.scheduleState,selectedDate:n.selectedDate,setSortBy:i,sortBy:s},children:t})}function tn(){const e=S.useContext(Kt);if(void 0===e)throw new Error("useSchedules must be used within a SchedulesProvider");return e}const nn=()=>!1===Ye()?k.jsx(w.Card,{padding:4,tone:"caution",children:k.jsxs(w.Flex,{align:"center",gap:3,children:[k.jsx(w.Text,{size:2,children:k.jsx(v.InfoOutlineIcon,{})}),k.jsx(w.Text,{size:1,children:se})]})}):null;function sn(e,t){return S.useMemo((()=>e.filter((e=>e.state===t))),[e,t])}const ln=e=>{const{selected:t,schedules:n,state:s}=e,i=m(e,o),l=sn(n,s).length,a=l>0,r="cancelled"===s,d="cancelled"===s&&a;return k.jsx(w.Tab,j(j({as:C.StateLink,id:s,paddingX:1,paddingY:2,selected:t,state:{state:s},tone:r?"critical":"default"},i),{},{children:k.jsxs(w.Flex,{align:"center",paddingX:1,children:[k.jsx(w.Text,{size:2,weight:"medium",children:ee[s].title}),k.jsx(w.Box,{marginLeft:l>0?2:0,style:{background:d?R.red[500].hex:"transparent",color:d?R.white.hex:"inherit",border:"none",boxShadow:"none",borderRadius:"2px",visibility:a?"visible":"hidden",padding:a?"0.25em 0.4em":"0.25em 0",width:a?"auto":0},children:k.jsx(w.Text,{size:1,style:{color:d?R.white.hex:"inherit"},children:l})})]})}))},an=e=>{const{onClearDate:t,selectedDate:n}=e,{navigate:s}=C.useRouter(),{schedules:i,scheduleState:l}=tn(),a=e=>{s(e)},o=sn(i,l);return k.jsxs(k.Fragment,{children:[k.jsxs(w.Box,{display:["block","block","none"],children:[n&&k.jsx(w.Button,{fontSize:2,iconRight:v.CloseIcon,onClick:t,text:I.format(n,"d MMMM yyyy"),tone:"primary"}),l&&k.jsx(w.MenuButton,{button:k.jsx(w.Button,{fontSize:2,iconRight:v.SelectIcon,mode:"ghost",text:"".concat(ee[l].title," (").concat((null==o?void 0:o.length)||0,")"),tone:"default"}),id:"state",menu:k.jsxs(w.Menu,{style:{minWidth:"175px"},children:[k.jsx(w.Box,{paddingX:3,paddingY:2,children:k.jsx(w.Label,{muted:!0,size:1,children:"Scheduled state"})}),te.map((e=>k.jsx(w.MenuItem,{iconRight:e===l?v.CheckmarkIcon:void 0,onClick:a.bind(void 0,{state:e}),text:ee[e].title},e)))]}),placement:"bottom"})]}),k.jsxs(w.Box,{display:["none","none","block"],children:[n&&k.jsx(w.Button,{iconRight:v.CloseIcon,onClick:t,text:I.format(n,"d MMMM yyyy"),tone:"primary"}),l&&k.jsx(w.TabList,{space:2,children:te.map((e=>k.jsx(ln,{schedules:i,selected:l===e,state:e},e)))})]})]})},on=e=>k.jsxs("svg",j(j({width:"100",height:"100",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:[k.jsx("path",{d:"M54 26C54 28.7614 49.0751 31 43 31C36.9249 31 32 28.7614 32 26C32 23.2386 36.9249 7 43 7C49.0751 7 54 23.2386 54 26Z",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M65 71.5V57M65 71.5L60.5789 69.0132M65 71.5L60.5789 73.9868M65 57L57 52.5L54 54.1875M65 57V42.5M65 57L57 47M65 57L58.1586 60.8483M65 57L60.5789 67.5M65 42.5L57 38L54 39.6875M65 42.5L57 47M65 42.5V27.5M57 47L65 27.5M57 47L54 39.6875M57 47L54 45.3125M57 47L54 50.75M57 23L65 27.5M57 23L54 24.6875V39.6875M57 23V60M65 27.5L57 32L54 30.3125",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M54 76C54 78.7614 49.0751 81 43 81C36.9249 81 32 78.7614 32 76M54 76H60.5V63L54 57M54 76V57M32 76H25V63L32 57M32 76V57M32 26V57M54 26V57M54 45C54 47.7614 49.0751 50 43 50V35C49.0751 35 54 32.7614 54 30",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M43 45.5701H44.8976L45.8465 43.1981L46.9679 42.7335L49.3162 43.7399L50.658 42.3981L49.6516 40.0499L50.1161 38.9284L52.4882 37.9795V36.0819L50.1161 35.1331L49.6516 34.0116M47.1334 34.9653C47.5197 35.5597 47.7441 36.269 47.7441 37.0307C47.7441 39.1268 46.0449 40.826 43.9488 40.826C43.6212 40.826 43.3033 40.7845 43 40.7064",stroke:"#7B8CA8",strokeWidth:"1.2",strokeLinejoin:"round"}),k.jsx("path",{d:"M63.5464 78.6739L64.9606 78.0321L67.4355 78.5135L68.6174 78.2913L69.6174 77.1566H71.6174L72.6174 78.2913L73.7994 78.5135L76.2743 78.0321L77.6885 78.6739M63.5464 78.6739L64.607 79.7972L64.1174 80.3336L63.5464 80.4373M63.5464 78.6739V80.4373M77.6885 78.6739L76.6278 79.7972L77.1174 80.3336L77.6885 80.4373M77.6885 78.6739V80.4373M63.5464 80.4373L61.6174 80.7875V81.6952L64.1174 82.1491L64.607 82.6855L63.5464 83.8088L64.9606 84.4506L67.4355 83.9693L68.6174 84.1915L69.6174 85.3261H71.6174L72.6174 84.1915L73.7994 83.9693L76.2743 84.4506L77.6885 83.8088L76.6278 82.6855L77.1174 82.1491L79.6174 81.6952V80.7875L77.6885 80.4373",stroke:"#7B8CA8",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"}),k.jsx("path",{d:"M79.6174 81.4647V84.7162L77.6885 85.0664M76.2743 87.4716L77.6885 86.8298V85.0664M76.2743 87.4716L73.7994 86.9902L72.6174 87.2124L71.6174 88.3471M76.2743 87.4716V84.7162M61.6174 81.4647V84.7162L63.5464 85.0664M71.6174 88.3471H69.6174M71.6174 88.3471V85.3261M69.6174 88.3471L68.6174 87.2124L67.4355 86.9902L64.9606 87.4716M69.6174 88.3471V85.3261M64.9606 87.4716L64.2535 87.1507L63.5464 86.8298V85.0664M64.9606 87.4716V84.6825M63.5464 84.039V85.0664M77.6885 84.039V85.0664",stroke:"#7B8CA8",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"}),k.jsx("path",{d:"M73.6174 81.2412C73.6174 81.9932 72.2743 82.6028 70.6174 82.6028C68.9606 82.6028 67.6174 81.9932 67.6174 81.2412C67.6174 80.4892 68.9606 79.8796 70.6174 79.8796C72.2743 79.8796 73.6174 80.4892 73.6174 81.2412Z",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M90 85.3616C90 86.1136 88.6569 86.7232 87 86.7232C85.3431 86.7232 84 86.1136 84 85.3616M90 85.3616C90 84.6096 88.6569 84 87 84C85.3431 84 84 84.6096 84 85.3616M90 85.3616V87.3616C90 88.1136 88.6569 88.7232 87 88.7232C85.3431 88.7232 84 88.1136 84 87.3616V85.3616",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M82 89.8648C82 90.3425 81.3284 90.7297 80.5 90.7297C79.6716 90.7297 79 90.3425 79 89.8648M82 89.8648C82 89.3872 81.3284 89 80.5 89C79.6716 89 79 89.3872 79 89.8648M82 89.8648V91.1352C82 91.6128 81.3284 92 80.5 92C79.6716 92 79 91.6128 79 91.1352V89.8648",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M52.7555 46.7289L52.5381 45.0136L51.2951 44.6903L50.2695 46.0824L49.4558 46.1956L48.0892 45.1364L46.9817 45.7867L47.2408 47.4962L46.7455 48.1517L45.0302 48.3691L44.7069 49.612M51.1084 47.9593C49.8968 47.6442 48.6622 48.2485 48.1434 49.3385",stroke:"#7B8CA8",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"}),k.jsx("path",{d:"M39 80.5L38 83.5C38 84.8807 40.2386 86 43 86C45.7614 86 48 84.8807 48 83.5L47 80.5",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M32 77L31 80C31 81.3807 33.2386 82.5 36 82.5C36.9107 82.5 37.7646 82.3783 38.5 82.1655",stroke:"#7B8CA8",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"}),k.jsx("path",{d:"M54 77L55 80C55 81.3807 52.7614 82.5 50 82.5C49.0893 82.5 48.2354 82.3783 47.5 82.1655",stroke:"#7B8CA8",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"})]})),rn=e=>k.jsxs("svg",j(j({width:"100",height:"100",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:[k.jsx("path",{d:"M35 84.5L41.7308 67H50V69.5M65 84.5L58.2692 67M32 65H42.5H50H57.5H81V23H19V65H24",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M84 16V23H16V16M84 16H16M84 16L82 14H18L16 16",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M24 65H18L17 67H83L82 65H32",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("circle",{cx:"50",cy:"72",r:"2",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M24 63C24 61.8954 24.8954 61 26 61H30C31.1046 61 32 61.8954 32 63V67H24V63Z",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M24 65C24 63.8954 24.8954 63 26 63H30C31.1046 63 32 63.8954 32 65V67H24V65Z",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M28 44.9975C31.0617 44.62 33.5601 42.4793 35.2478 39.995C36.199 38.5947 36.9116 37.0761 36.9653 35.3597C36.9973 34.3355 36.8332 33.1459 35.8944 32.5454C35.3035 32.1675 34.4935 32.0285 33.8044 32.0022C32.7788 31.9631 32.1643 32.4357 31.8489 33.4197C30.3123 38.2145 33.0184 42.7025 36.3911 45.8977C38.1152 47.531 40.0746 48.9275 42.1179 50.1294C43.9867 51.2287 46.003 52.2595 48.1189 52.7885C48.9466 52.9954 50.4951 53.3913 51.3211 52.954C52.3579 52.4051 51.8285 49.7323 51.7091 48.9809C51.3862 46.9486 50.7293 45.0311 49.8726 43.1662C49.3791 42.0918 48.7948 40.8004 47.9999 39.8967C47.4959 39.3237 47.1331 39.4889 47.1101 40.2278C47.0699 41.5204 47.5768 42.7535 48.3103 43.7973C50.633 47.1024 54.4924 49.4656 58.2792 50.6985C59.9643 51.2471 61.8953 51.7306 63.6853 51.6193C65.3845 51.5137 65.6225 50.1321 65.7287 48.655C65.9958 44.9405 64.9629 40.7695 62.6403 37.7963C61.615 36.4839 60.3547 35.6334 58.6879 35.4476C57.7554 35.3437 56.665 35.3303 55.7391 35.5097C54.8073 35.6903 54.0162 36.297 54.3371 37.3462C54.6464 38.3572 55.8044 39.0666 56.6444 39.5759C57.983 40.3876 59.4813 40.9898 61.0262 41.2624C63.2658 41.6576 65.1745 41.1715 67.141 40.1346C67.9966 39.6835 68.8825 39.1795 69.4379 38.3861",stroke:"#7B8CA8",strokeWidth:"1.2"})]})),dn=e=>k.jsxs("svg",j(j({width:"100",height:"100",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:[k.jsx("path",{d:"M35.5034 34.5961C35.6531 34.1763 35.8628 33.792 36.1352 33.4478C37.6813 31.4827 40.9503 31.2145 44.9898 32.3554M35.5034 34.5961L24.12 78.5806C23.4656 81.1092 26.1309 83.2083 28.4357 81.9796L68.4485 60.6484M35.5034 34.5961C34.2315 38.1622 37.2902 44.2842 43.0792 50.0342M68.4485 60.6484C68.8174 60.4078 69.1391 60.118 69.4084 59.7777C70.9736 57.7883 70.4521 54.4677 68.3472 50.7308M68.4485 60.6484C65.1795 62.7806 58.1999 61.0522 51.0413 56.4338M49.3164 55.2667C48.6043 54.7622 47.8933 54.2299 47.1867 53.6707C46.3331 52.9953 45.5161 52.3044 44.7387 51.6037M49.3164 55.2667C49.8913 55.674 50.4669 56.0632 51.0413 56.4338M49.3164 55.2667C52.3445 53.1871 58.7283 49.8329 66.4965 47.8874M51.0413 56.4338C55.9305 53.432 62.4593 51.6876 68.3472 50.7308M43.0792 50.0342C43.6098 50.5612 44.1634 51.0852 44.7387 51.6037M43.0792 50.0342C44.4006 45.7138 45.8116 38.387 44.9898 32.3554M44.7387 51.6037C47.6743 44.2968 48.7135 38.3712 48.6643 33.6916M63.9622 36.487C63.2905 34.23 62.35 29.5386 63.9622 28.8293C65.9774 27.9426 68.5569 33.5045 70.8139 32.2148C73.0709 30.9251 69.4435 27.7814 70.8139 25.2019C72.1842 22.6224 79.6002 28.4262 81.2123 23.4285C82.502 19.4304 79.7614 16.6574 78.2298 15.7708M66.4965 47.8874C70.7697 46.8171 75.462 46.1731 80.2449 46.4019L80.2449 49.7068C77.5329 49.6936 73.1535 49.9498 68.3472 50.7308M66.4965 47.8874C64.45 45.1054 61.6564 42.2264 58.3003 39.5859C55.0633 37.039 51.7429 35.0416 48.6643 33.6916M48.6643 33.6916C48.5822 25.8794 45.4671 21.5396 43.0792 20.043L39.941 23.4285C42.9851 25.0774 44.4569 28.4441 44.9898 32.3554",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M32.2094 47.3001C31.0515 50.5465 34.6857 56.6214 40.9597 61.5862C47.2404 66.5562 53.9958 68.696 56.8839 66.8122",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M28.8867 60.1903C28.1245 62.3275 30.5169 66.3267 34.6472 69.595C38.7818 72.8669 43.229 74.2755 45.1303 73.0354",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M26.2718 70.2225C25.8147 71.5039 27.2491 73.9016 29.7254 75.8611C32.2044 77.8228 34.8707 78.6673 36.0106 77.9238",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("path",{d:"M28.0529 44.1724C29.5354 43.1981 32.3735 40.6904 31.8652 38.4538C31.2298 35.6581 22.8425 38.9622 22.7155 36.5477C22.5884 34.1331 27.0361 30.575 26.909 28.6688C26.7819 26.7626 18.6489 30.8291 18.6489 26.8896C18.6489 23.738 21.36 22.1029 22.7155 21.6793",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"21.8833",y:"50.1122",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 21.8833 50.1122)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"16.0527",y:"36.722",width:"3.03077",height:"3.03077",transform:"rotate(4.36851 16.0527 36.722)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"27.9448",y:"22.8353",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 27.9448 22.8353)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"53.7065",y:"33.443",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 53.7065 33.443)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"67.3447",y:"13.743",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 67.3447 13.743)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"74.9219",y:"54.6584",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 74.9219 54.6584)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"70.3755",y:"66.7814",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 70.3755 66.7814)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"77.9526",y:"78.9045",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 77.9526 78.9045)",stroke:"#7B8CA8",strokeWidth:"1.2"}),k.jsx("rect",{x:"82.4985",y:"62.2353",width:"3.03077",height:"3.03077",transform:"rotate(-24.7154 82.4985 62.2353)",stroke:"#7B8CA8",strokeWidth:"1.2"})]})),cn=e=>{const{scheduleState:t,selectedDate:n}=e;let s,i,l;switch(t){case"succeeded":i="When a scheduled document is successfully published it moves to this list view.",l="No completed scheduled publications ... yet",s=on;break;case"cancelled":i="Schedules can fail for several reasons, for example when their documents are deleted. When they do, they show up here.",l="No failed scheduled publications",s=dn;break;case"scheduled":i="When editing a document, create a new scheduled publication from the menu next to the Publish button.",l="No upcoming scheduled publications",s=rn}return n&&(i="No schedules for this date.",l=I.format(n,"d MMMM yyyy"),s=rn),k.jsx(w.Card,{paddingX:6,paddingBottom:8,paddingTop:7,radius:2,shadow:1,children:k.jsxs(w.Stack,{space:4,children:[k.jsx(w.Flex,{justify:"center",children:s&&k.jsx(s,{})}),k.jsxs(w.Stack,{space:4,children:[l&&k.jsx(w.Heading,{align:"center",size:1,children:l}),i&&k.jsx(w.Text,{align:"center",size:1,children:i})]})]})})};function un(e){const{item:{content:t,virtualRow:n}}=e,s=S.useMemo((()=>({position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(n.start,"px)")})),[n]);return"string"==typeof t?k.jsx("div",{ref:n.measureRef,style:j(j({},s),{},{height:0===n.index?30:60}),children:k.jsx(xn,{content:t})}):k.jsx("div",{ref:n.measureRef,style:j(j({},s),{},{height:59}),children:k.jsx(hn,{schedule:t})})}function hn(e){let{schedule:t}=e;const[n,s]=S.useState(k.jsx(pn,{}));return S.useEffect((()=>{let e=!0;const n=setTimeout((()=>{e&&s(k.jsx(Zt,{schedule:t,type:"tool"}))}),200);return()=>{e=!1,clearTimeout(n)}}),[t]),n}function xn(e){let{content:t}=e;return k.jsx(w.Flex,{align:"flex-end",paddingBottom:4,style:{bottom:0,position:"absolute"},children:k.jsx(w.Label,{muted:!0,size:1,children:t})})}function pn(){return k.jsx(w.Card,{padding:1,radius:2,shadow:1,children:k.jsx(w.Card,{padding:1,children:k.jsx(y.SanityDefaultPreview,{isPlaceholder:!0})})})}function mn(e){return new Date(e).toLocaleString("default",{month:"long",year:"numeric"})}const fn=()=>{const{activeSchedules:e,scheduleState:t,sortBy:n}=tn(),{virtualList:s,totalSize:i,containerRef:l}=function(e,t){const n=H.default.useRef(null),s=S.useMemo((()=>{const n=[];return e.forEach(((s,i)=>{if("executeAt"==t){const t=Ge(e[i-1]),l=i>0&&t?mn(t):null,a=Ge(s),o=a?mn(a):null;o!==l&&n.push(o||"No date specified")}n.push(s)})),n}),[e,t]),{virtualItems:i,totalSize:l}=W.useVirtual({size:s.length,parentRef:n,overscan:5});return{virtualList:S.useMemo((()=>i.map((e=>{const t=s[e.index];return{content:t,key:"string"==typeof t?t:t.id,virtualRow:e}}))),[i,s]),totalSize:l,containerRef:n}}(e,n),{deleteSchedules:a}=tt();return S.useEffect((()=>{var e;null==(e=null==l?void 0:l.current)||e.scrollTo(0,0)}),[t,n,l]),k.jsxs(w.Box,{paddingBottom:6,paddingX:4,paddingTop:4,ref:l,style:{position:"relative",overflowX:"hidden",overflowY:"auto",height:"100%",boxSizing:"border-box"},children:[k.jsx(w.Box,{style:{height:"".concat(i,"px"),width:"100%",position:"relative"},children:s.map((e=>k.jsx(un,{item:e},e.key)))}),"succeeded"===t&&k.jsx(w.Flex,{justify:"center",marginTop:6,children:k.jsx(w.Button,{icon:v.CheckmarkCircleIcon,mode:"ghost",onClick:()=>{a({schedules:e||[]})},text:"Clear all completed schedules"})})]})};const jn=()=>{const{activeSchedules:e,selectedDate:t,scheduleState:n}=tn();return k.jsx(w.Box,{style:{height:"100%"},children:0===e.length?k.jsx(w.Box,{padding:4,children:k.jsx(cn,{scheduleState:n,selectedDate:t})}):k.jsx(fn,{})})},gn=()=>{const{setSortBy:e,sortBy:t}=tn();return k.jsx(w.MenuButton,{button:k.jsx(w.Button,{icon:v.EllipsisVerticalIcon,mode:"bleed",paddingX:2,paddingY:3,tone:"default"}),id:"sort",menu:k.jsxs(w.Menu,{style:{minWidth:"250px"},children:[k.jsx(w.Box,{paddingX:3,paddingY:2,children:k.jsx(w.Label,{muted:!0,size:1,children:"Sort"})}),k.jsx(w.MenuItem,{icon:v.SortIcon,iconRight:"createdAt"===t?v.CheckmarkIcon:void 0,onClick:()=>e("createdAt"),text:"Sort by time added"}),k.jsx(w.MenuItem,{icon:v.SortIcon,iconRight:"executeAt"===t?v.CheckmarkIcon:void 0,onClick:()=>e("executeAt"),text:"Sort by time scheduled"})]})})},bn=e=>{const{mode:t="default",selected:n}=e;return k.jsx(w.Box,{style:j(j(j({},"default"===t?{background:R.gray[n?100:300].hex}:{}),"failed"===t?{background:R.red[500].hex}:{}),{},{borderRadius:"2px",height:"2px",width:"100%"})})};function vn(e){const{date:t,focused:n,isCurrentMonth:s,isToday:i,onSelect:l,selected:a}=e,{schedulesByDate:o}=tn(),r=o(t),d=S.useCallback((()=>{l(a?void 0:t)}),[t,l,a]);let c;c=i||a?"primary":(I.isWeekend(t),"default");const u=r.length>0,{completed:h,failed:x,upcoming:p}=S.useMemo((()=>({completed:r.filter((e=>"succeeded"===e.state)),failed:r.filter((e=>"cancelled"===e.state)),upcoming:r.filter((e=>"scheduled"===e.state))})),[r]);return k.jsx("div",{"aria-selected":a,"data-ui":"CalendarDay",children:k.jsx(w.Tooltip,{content:k.jsx(yn,{date:t,schedules:r}),disabled:!u,portal:!0,children:k.jsxs(w.Card,{"aria-label":t.toDateString(),"aria-pressed":a,as:"button",__unstable_focusRing:!0,"data-weekday":!0,"data-focused":n?"true":"",role:"button",tabIndex:-1,onClick:d,paddingX:3,paddingY:4,radius:2,selected:a,style:{position:"relative"},tone:c,children:[k.jsx(w.Text,{size:1,style:{opacity:a||s?1:.35,textAlign:"center"},children:a?k.jsx(v.CloseIcon,{}):t.getDate()}),k.jsx(w.Box,{style:{bottom:2,left:2,position:"absolute",right:2},children:k.jsxs(w.Flex,{align:"center",gap:1,justify:"center",children:[h.length>0&&k.jsx(bn,{selected:a}),p.length>0&&k.jsx(bn,{selected:a}),x.length>0&&k.jsx(bn,{mode:"failed",selected:a})]})})]})})})}function yn(e){const{date:t,schedules:n=[]}=e,{formatDateTz:s}=he(),i=n.reduce(((e,t)=>(e[t.state].push(t),e)),{cancelled:[],succeeded:[],scheduled:[]});return k.jsxs(w.Box,{padding:3,children:[k.jsx(w.Box,{marginBottom:4,children:k.jsx(w.Text,{size:1,weight:"medium",children:I.format(t,"d MMMM yyyy")})}),k.jsx(w.Stack,{space:3,children:Object.keys(i).map((e=>{const t=i[e];return 0===t.length?null:k.jsxs(w.Stack,{space:2,children:[k.jsx(w.Label,{muted:!0,size:0,children:ee[e].title}),k.jsx(w.Stack,{space:1,children:t.filter((e=>e.executeAt)).map((e=>{const t=Ge(e);return t?k.jsxs(w.Inline,{space:2,children:[k.jsx(w.Box,{style:{width:"60px"},children:k.jsx(w.Text,{size:1,weight:"regular",children:s({date:new Date(t),format:"p"})})}),k.jsx(w.Flex,{align:"center",style:{flexShrink:0,opacity:"unpublish"===e.action?1:0},children:k.jsx(w.Badge,{fontSize:0,mode:"outline",tone:$[e.action].badgeTone,children:e.action})})]},e.id):null}))})]},e)}))})]})}const Cn=["January","February","March","April","May","June","July","August","September","October","November","December"],kn=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wn=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Sn=[1,2,3,4,5,6],Mn=e=>{return(t=(e=>{const t=I.startOfMonth(e);return I.eachWeekOfInterval({start:t,end:I.lastDayOfMonth(t)})})(e),t.map((e=>[e,...Sn.map((t=>I.addDays(e,t)))]))).map((e=>({number:I.getWeek(e[0]),days:e})));var t};function Tn(e){const{getCurrentZoneDate:t}=he();return k.jsx(w.Box,{"aria-hidden":e.hidden||!1,"data-ui":"CalendarMonth",children:k.jsxs(w.Grid,{style:{gridGap:"1px",gridTemplateColumns:"repeat(7, 1fr)"},children:[kn.map((e=>k.jsx(w.Card,{paddingY:3,children:k.jsx(w.Label,{size:1,style:{textAlign:"center"},children:e.substring(0,1)})},e))),Mn(e.date).map(((n,s)=>n.days.map(((n,i)=>{const l=e.focused&&I.isSameDay(n,e.focused),a=e.selected&&I.isSameDay(n,e.selected),o=I.isSameDay(n,t()),r=e.focused&&I.isSameMonth(n,e.focused);return k.jsx(vn,{date:n,focused:l,isCurrentMonth:r,isToday:o,onSelect:e.onSelect,selected:a},"".concat(s,"-").concat(i))}))))]})})}const Dn=k.jsx("span",{"data-preserve-focus":!0,style:{overflow:"hidden",position:"absolute",outline:"none"},tabIndex:-1}),Ln=S.forwardRef((function(e,t){const{focusedDate:n,onFocusedDateChange:s,onSelect:i,selectedDate:l}=e,a=m(e,r),{zoneDateToUtc:o}=he(),d=S.useCallback((e=>s(o(e))),[s,o]),c=S.useCallback((e=>d(I.addMonths(n,e))),[n,d]),u=S.useCallback((e=>{if(e){const t=o(I.setMinutes(I.setHours(e,e.getHours()),e.getMinutes()));i(t),s(t)}else i(void 0)}),[i,o,s]),h=w.useForwardedRef(t),x=S.useCallback((()=>{var e,t;null==(t=null==(e=h.current)?void 0:e.querySelector('[data-focused="true"]'))||t.focus()}),[h]),p=S.useCallback((e=>{var t,i;wn.includes(e.key)&&(e.preventDefault(),e.currentTarget.hasAttribute("data-calendar-grid")?x():("ArrowUp"===e.key&&s(o(I.addDays(n,-7))),"ArrowDown"===e.key&&s(o(I.addDays(n,7))),"ArrowLeft"===e.key&&s(o(I.addDays(n,-1))),"ArrowRight"===e.key&&s(o(I.addDays(n,1))),null==(i=null==(t=h.current)?void 0:t.querySelector("[data-preserve-focus]"))||i.focus()))}),[h,x,s,n,o]);S.useEffect((()=>{x()}),[x]),S.useEffect((()=>{var e;(null==(e=document.activeElement)?void 0:e.matches("[data-calendar-grid], [data-calendar-grid] [data-preserve-focus]"))&&x()}),[h,x,n]);const f=S.useCallback((()=>{const e=new Date;i(e),s(e)}),[i,s]),g=S.useCallback((()=>c(-1)),[c]),b=S.useCallback((()=>c(1)),[c]);return k.jsxs(w.Box,j(j({"data-ui":"Calendar"},a),{},{ref:h,children:[k.jsx(w.Flex,{align:"center",paddingLeft:4,style:{borderBottom:"1px solid var(--card-border-color)",minHeight:"".concat(55,"px"),position:"sticky",top:0},children:k.jsxs(w.Flex,{align:"center",flex:1,justify:"space-between",children:[k.jsxs(w.Text,{weight:"medium",children:[Cn[null==n?void 0:n.getMonth()]," ",null==n?void 0:n.getFullYear()]}),k.jsxs(w.Flex,{children:[k.jsx(w.Button,{icon:v.ChevronLeftIcon,mode:"bleed",onClick:g,radius:0,style:{height:"55px",width:"50px"}}),k.jsx(w.Button,{icon:v.ChevronRightIcon,mode:"bleed",onClick:b,radius:0,style:{height:"55px",width:"50px"}})]})]})}),k.jsx(w.Box,{children:k.jsxs(w.Box,{"data-calendar-grid":!0,onKeyDown:p,overflow:"hidden",paddingBottom:1,paddingX:1,tabIndex:0,children:[k.jsx(Tn,{date:n,focused:n,onSelect:u,selected:l}),Dn]})}),k.jsx(w.Box,{flex:1,style:{borderBottom:"1px solid var(--card-border-color)"},children:k.jsx(w.Button,{fontSize:1,mode:"bleed",onClick:f,padding:4,radius:0,style:{width:"100%"},text:"Today"})})]}))})),In=e=>{const{onSelect:t,selectedDate:n}=e,{getCurrentZoneDate:s,utcToCurrentZoneDate:i}=he(),[l,a]=S.useState(n||s()),o=S.useCallback((e=>{a(i(e))}),[i]);return k.jsx(Ln,{focusedDate:l,onFocusedDateChange:o,onSelect:t,selectedDate:n})},Bn=Z.default(w.Box)(p||(p=b(["\n  flex-direction: column;\n  &:not(:last-child) {\n    border-right: 1px solid var(--card-border-color);\n  }\n"]))),An=[];function zn(){const e=C.useRouter(),{sanity:t}=w.useTheme(),{error:n,isInitialLoading:s,schedules:i=An}=at(),l=S.useRef(),a=e.state.state,o=e.state.date?I.parse(e.state.date,"yyyy-MM-dd",new Date):void 0;S.useEffect((()=>{e.state.state&&(l.current=e.state.state)}),[e.state.state]),function(e,t,n){S.useEffect((()=>{t||n||e.navigate({state:te[0]},{replace:!0})}),[n,e,t])}(e,a,o);const{formatDateTz:r}=he(),d=S.useMemo((()=>({schedules:i,scheduleState:a,selectedDate:o})),[i,a,o]);return k.jsx(en,{value:d,children:k.jsxs(w.Flex,{direction:"column",height:"fill",flex:1,overflow:"hidden",children:[k.jsx(nn,{}),k.jsxs(w.Flex,{flex:1,height:"fill",children:[k.jsx(Bn,{display:["none",null,null,"flex"],style:{position:"sticky",top:0,width:"350px"},children:k.jsx(In,{onSelect:t=>{t?e.navigate({date:r({date:t,format:"yyyy-MM-dd"})}):e.navigate({state:(null==l?void 0:l.current)||te[0]})},selectedDate:o})}),k.jsxs(Bn,{display:"flex",flex:1,overflow:"hidden",children:[k.jsx(be,{style:{background:t.color.card.enabled.bg,position:"sticky",top:0,zIndex:1},children:k.jsx(w.Flex,{align:"center",paddingLeft:4,paddingRight:3,style:{borderBottom:"1px solid var(--card-border-color)",minHeight:"".concat(55,"px")},children:k.jsxs(w.Flex,{align:"center",flex:1,justify:"space-between",children:[k.jsx(an,{onClearDate:()=>{e.navigate({state:(null==l?void 0:l.current)||te[0]})},selectedDate:o}),k.jsxs(w.Flex,{align:"center",gap:1,children:[k.jsx(ge,{useElementQueries:!0}),k.jsx(gn,{})]})]})})}),k.jsxs(w.Flex,{direction:"column",flex:1,children:[n&&k.jsx(w.Box,{paddingTop:4,paddingX:4,children:k.jsx(Ze,{description:"More information in the developer console.",title:"Something went wrong, unable to retrieve schedules."})}),k.jsx(w.Box,{flex:1,children:s?k.jsx(w.Box,{padding:4,children:k.jsx(w.Text,{muted:!0,children:"Loading..."})}):k.jsx(jn,{})})]})]})]})]})})}function En(e){const{id:t,markers:n}=e,s=rt(t),{hasError:i}=xt(n),{schedules:l}=at({documentId:s,state:"scheduled"});return l.length>0?k.jsx(w.Box,{marginBottom:4,children:k.jsx(w.Card,{padding:3,radius:1,shadow:1,tone:i?"critical":"primary",children:k.jsxs(w.Stack,{space:2,children:[k.jsxs(w.Flex,{align:"center",gap:3,marginBottom:1,padding:1,children:[k.jsx(w.Text,{muted:!0,size:1,children:k.jsx(v.CalendarIcon,{})}),k.jsxs(w.Text,{muted:!0,size:1,children:[k.jsx("span",{style:{fontWeight:600},children:"Upcoming schedule"})," (local time)"]})]}),k.jsx(w.Stack,{space:2,children:l.map((e=>{if(!e.executeAt)return null;const t=I.format(new Date(e.executeAt),ie.LARGE);return k.jsxs(w.Inline,{space:2,children:[k.jsx(w.Text,{muted:!0,size:1,children:t}),k.jsx(w.Flex,{style:{opacity:"unpublish"===e.action?1:0},children:k.jsx(w.Badge,{fontSize:0,mode:"outline",children:e.action})})]},e.id)}))}),i&&k.jsx(w.Box,{marginTop:3,children:k.jsx(w.Text,{muted:!0,size:1,weight:"regular",children:ne})})]})})}):null}function Vn(e){const{value:t,validation:n,children:s}=e,i=t,l=S.useMemo((()=>n.map((e=>({level:e.level,path:e.path,item:{message:e.message}})))),[n]);return k.jsxs(k.Fragment,{children:[(null==i?void 0:i._id)?k.jsx(En,{id:i._id,markers:l}):null,s]})}function Fn(e){return e.type?Fn(e.type):e}const On=y.definePlugin({name:"scheduled-publishing",document:{actions:e=>Yt(e),badges:e=>Jt(e)},form:{components:{input:e=>{const{schemaType:t}=e;return"document"===Fn(t).name?k.jsx(Vn,j(j({},e),{},{children:e.renderDefault(e)})):e.renderDefault(e)}}},tools:e=>[...e,{name:"schedules",title:"Schedules",icon:v.CalendarIcon,component:zn,router:C.route.create("/",[C.route.create("/state/:state"),C.route.create("/date/:date")])}]});exports.EditScheduleForm=He,exports.ScheduleAction=Xt,exports.ScheduledBadge=Qt,exports.resolveDocumentActions=Yt,exports.resolveDocumentBadges=Jt,exports.scheduledPublishing=On;
//# sourceMappingURL=index.js.map
